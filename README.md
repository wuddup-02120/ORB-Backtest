# ORB Backtest Repository

## Overview
This repository contains scripts and datasets for backtesting the Opening Range Breakout (ORB) strategy. It includes tools for data preparation, portfolio simulation, and results visualization. The repository is designed to handle large datasets efficiently using Git Large File Storage (LFS).

---

## Features
- **Data Resampling**: Convert raw 1-minute interval data into 15-minute and 5-minute intervals.
- **Portfolio Simulation**: Simulate trades based on risk-reward (RR) levels and generate equity curves.
- **Result Analysis**: Split backtest results by RR levels for detailed performance analysis.
- **Efficient Handling of Large Files**: Uses Git LFS for managing large datasets.

---

## Repository Structure
```
ORB_Strat/
├── Datasets/                # Contains resampled datasets and raw data files
├── Equity_Curve_Plots/      # Equity curve images generated by simulations
├── Portfolio_Sim_Results/   # Combined portfolio simulation results
├── RR_Level_Datasets/       # Backtest results split by RR levels
├── Backtest_Results/        # Aggregated backtest results
├── Scripts/                 # Python scripts for backtesting and data processing
│   ├── backtest.py                   # Main backtest script
│   ├── Portfolio_Sims.py             # Portfolio simulation
│   ├── Generate_Resampled_Datasets.py# Data resampling
│   ├── Split_Backtest_Results_File_By_RR_Level.py
└── README.md               # Project documentation
```

---

## Setup and Usage

### Prerequisites
1. Install [Python](https://www.python.org/) (version 3.8 or later).
2. Install required Python libraries:
   ```bash
   pip install -r requirements.txt
   ```
3. Install [Git LFS](https://git-lfs.github.com/) for managing large files.

### Step-by-Step Guide

#### Clone the Repository
```bash
git clone https://github.com/wuddup-02120/ORB-Backtest.git
cd ORB-Backtest
```

#### Set Up Git LFS
```bash
git lfs install
git lfs pull
```

#### Running the Scripts

1. **Resample Datasets**:
   ```bash
   python Scripts/Generate_Resampled_Datasets.py \
       --input_file Datasets/raw_data.csv \
       --output_dir Datasets/
   ```

2. **Run Backtest**:
   ```bash
   python Scripts/backtest.py \
       --file_15min Datasets/SPY_15min.csv \
       --file_5min Datasets/SPY_5min.csv \
       --file_1min Datasets/SPY_full_1min_UNADJUSTED.txt \
       --output_file Backtest_Results/backtest_results.csv
   ```

3. **Simulate Portfolios**:
   ```bash
   python Scripts/Portfolio_Sims.py \
       --input_directory Datasets/ \
       --output_directory Portfolio_Sim_Results/ \
       --equity_curve_directory Equity_Curve_Plots/
   ```

4. **Split Backtest Results by RR Levels**:
   ```bash
   python Scripts/Split_Backtest_Results_File_By_RR_Level.py \
       --results_file Backtest_Results/backtest_results.csv \
       --output_directory RR_Level_Datasets/
   ```

# Opening Range Breakout Strategy

## Strategy Overview: Opening Range Breakout with Risk-Reward Levels

### Objective
The strategy aims to exploit intraday price movements by identifying breakout opportunities based on the first 15-minute price range after market open. By employing precise entry and exit criteria tied to risk-reward (RR) levels, this approach seeks to maximize returns while minimizing drawdowns.

### Workflow and Logic

1. **Data Inputs**:
   - **15-Minute Data**: Used to calculate the opening range (high and low prices between 09:30 and 09:45).
   - **5-Minute Data**: Used to detect breakout patterns and entry opportunities.
   - **1-Minute Data**: Used for precise simulation of trade outcomes, including stop-loss and target evaluations.

2. **Range Identification**:
   - For each trading day, the high and low prices of the first 15-minute candle (09:30–09:45) are extracted to define the opening range.

3. **Breakout Detection**:
   - After the range is established, the strategy monitors price movements from 09:50 to 11:30 using 5-minute data.
   - A breakout is identified if:
     - The **closing price** of a 5-minute candle moves above the range high (for a long trade) or below the range low (for a short trade).

4. **Re-Entry Criteria**:
   - For a valid entry:
     - Long trades require a pullback below the range high, followed by a close back above it.
     - Short trades require a pullback above the range low, followed by a close back below it.

5. **Trade Execution**:
   - **Entry Price**: Determined based on the re-entry candle's close price.
   - **Stop-Loss**: Set based on the risk level:
     - Long: `entry_price - (entry_price * RR)`
     - Short: `entry_price + (entry_price * RR)`
   - **Target**: Defined as twice the risk level:
     - Long: `entry_price + (entry_price * 2 * RR)`
     - Short: `entry_price - (entry_price * 2 * RR)`

6. **Outcome Simulation**:
   - Using 1-minute data, the strategy evaluates each trade until either the target or stop-loss is hit.
   - If no condition is met during the trading session, the trade remains open and is marked as active.

7. **Performance Metrics**:
   - **Percentage Return**: The profit or loss as a percentage of the entry price.
   - **Maximum Drawdown**: The largest unfavorable price movement during the trade, expressed as a percentage of the entry price.

### Risk-Reward Levels
The strategy systematically tests a range of RR levels from **0.001 (0.10%) to 0.020 (2%)** in increments of 0.001. This allows for detailed analysis of the profitability and risk dynamics across varying risk-reward thresholds.

### Outputs
The results of the backtest are saved in a CSV file with the following key metrics:
- Risk-Reward Level (`RR_Level`)
- Trade Direction (`Direction`): Long or Short
- Entry Time and Price
- Exit Time and Price
- Maximum Drawdown (`Max_Drawdown`)
- Percentage Return (`Percentage_Return`)

### Example Use Case
This strategy is particularly suited for intraday traders aiming to capture early session momentum with predefined risk management. It allows for flexible adjustments to risk-reward levels to align with individual trading styles or market conditions.

### How to Run the Backtest
To execute the strategy, use the following command:
```bash
python your_script.py --file_15min path_to_15min_data.csv --file_5min path_to_5min_data.csv --file_1min path_to_1min_data.csv --output_file backtest_results.csv
```

## Results Overview

## Simulation Results

Below is a screenshot of the portfolio simulation results for 1:1 RR:

![Simulation Results](Equity_Curve_Plots/sim_results_screenshot.png)

### Equity Curve Plots 1:1 RR
Below are the equity curve plots for different risk-reward levels:

#### RR Level 0.001
![Equity Curve for RR 0.001](Equity_Curve_Plots/equity_curve_RR_0.001.png)

#### RR Level 0.002
![Equity Curve for RR 0.002](Equity_Curve_Plots/equity_curve_RR_0.002.png)

#### RR Level 0.003
![Equity Curve for RR 0.003](Equity_Curve_Plots/equity_curve_RR_0.003.png)

#### RR Level 0.004
![Equity Curve for RR 0.004](Equity_Curve_Plots/equity_curve_RR_0.004.png)

#### RR Level 0.005
![Equity Curve for RR 0.005](Equity_Curve_Plots/equity_curve_RR_0.005.png)

#### RR Level 0.006
![Equity Curve for RR 0.006](Equity_Curve_Plots/equity_curve_RR_0.006.png)

#### RR Level 0.007
![Equity Curve for RR 0.007](Equity_Curve_Plots/equity_curve_RR_0.007.png)

#### RR Level 0.008
![Equity Curve for RR 0.008](Equity_Curve_Plots/equity_curve_RR_0.008.png)

#### RR Level 0.009
![Equity Curve for RR 0.009](Equity_Curve_Plots/equity_curve_RR_0.009.png)

#### RR Level 0.010
![Equity Curve for RR 0.010](Equity_Curve_Plots/equity_curve_RR_0.010.png)

#### RR Level 0.011
![Equity Curve for RR 0.001](Equity_Curve_Plots/equity_curve_RR_0.011.png)

#### RR Level 0.012
![Equity Curve for RR 0.002](Equity_Curve_Plots/equity_curve_RR_0.012.png)

#### RR Level 0.013
![Equity Curve for RR 0.003](Equity_Curve_Plots/equity_curve_RR_0.013.png)

#### RR Level 0.014
![Equity Curve for RR 0.004](Equity_Curve_Plots/equity_curve_RR_0.014.png)

#### RR Level 0.015
![Equity Curve for RR 0.005](Equity_Curve_Plots/equity_curve_RR_0.015.png)

#### RR Level 0.016
![Equity Curve for RR 0.006](Equity_Curve_Plots/equity_curve_RR_0.016.png)

#### RR Level 0.017
![Equity Curve for RR 0.007](Equity_Curve_Plots/equity_curve_RR_0.017.png)

#### RR Level 0.018
![Equity Curve for RR 0.008](Equity_Curve_Plots/equity_curve_RR_0.018.png)

#### RR Level 0.019
![Equity Curve for RR 0.009](Equity_Curve_Plots/equity_curve_RR_0.019.png)

#### RR Level 0.020
![Equity Curve for RR 0.010](Equity_Curve_Plots/equity_curve_RR_0.020.png)

Below is a screenshot of the portfolio simulation results for 1:2 RR:

![Simulation Results](Equity_Curve_Plots_1_2_RR/1_2_RR_backtest_results.png)

### Equity Curve Plots 1:2 RR
Below are the equity curve plots for different risk-reward levels:

#### RR Level 0.001
![Equity Curve for RR 0.001](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.001.png)

#### RR Level 0.002
![Equity Curve for RR 0.002](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.002.png)

#### RR Level 0.003
![Equity Curve for RR 0.003](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.003.png)

#### RR Level 0.004
![Equity Curve for RR 0.004](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.004.png)

#### RR Level 0.005
![Equity Curve for RR 0.005](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.005.png)

#### RR Level 0.006
![Equity Curve for RR 0.006](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.006.png)

#### RR Level 0.007
![Equity Curve for RR 0.007](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.007.png)

#### RR Level 0.008
![Equity Curve for RR 0.008](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.008.png)

#### RR Level 0.009
![Equity Curve for RR 0.009](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.009.png)

#### RR Level 0.010
![Equity Curve for RR 0.010](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.010.png)

#### RR Level 0.011
![Equity Curve for RR 0.011](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.011.png)

#### RR Level 0.012
![Equity Curve for RR 0.012](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.012.png)

#### RR Level 0.013
![Equity Curve for RR 0.013](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.013.png)

#### RR Level 0.014
![Equity Curve for RR 0.014](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.014.png)

#### RR Level 0.015
![Equity Curve for RR 0.015](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.015.png)

#### RR Level 0.016
![Equity Curve for RR 0.016](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.016.png)

#### RR Level 0.017
![Equity Curve for RR 0.017](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.017.png)

#### RR Level 0.018
![Equity Curve for RR 0.018](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.018.png)

#### RR Level 0.019
![Equity Curve for RR 0.019](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.019.png)

#### RR Level 0.020
![Equity Curve for RR 0.020](Equity_Curve_Plots_1_2_RR/equity_curve_RR_0.020.png)

---

## Example Workflow
1. Resample raw data into 15-minute and 5-minute intervals.
2. Run the backtest script on resampled data.
3. Analyze portfolio performance by generating equity curves.
4. Split results by RR levels for granular analysis.

---

## Contributing
Contributions are welcome! Please fork the repository, make changes, and submit a pull request.

---

## License
This project is licensed under the MIT License. See the LICENSE file for details.

---

## Support
For questions or support, please open an issue in the GitHub repository.
